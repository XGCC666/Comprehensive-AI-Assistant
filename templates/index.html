<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My AI Assistant</title>
    <link rel="stylesheet" href="/static/css/style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <div class="app-layout">
        
        <div class="nav-rail">
            <div class="rail-top">
                <div class="rail-icon" onclick="openRoleModal()" title="æ–°å¯¹è¯">
                    <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                </div>
                <div class="rail-icon active" onclick="togglePanel('history')" title="å†å²è®°å½•">
                    <svg viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>
                </div>
                <div class="rail-icon" onclick="openCreatePromptModal()" title="åˆ›å»ºåŠ©æ‰‹">
                    <svg viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                </div>
            </div>
            <div class="rail-bottom">
                <div class="rail-icon" onclick="openSettings()" title="è®¾ç½®">
                    <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                </div>
            </div>
        </div>

        <div class="side-panel" id="side-panel">
            <div class="panel-header">
                <h3>å†å²è®°å½•</h3>
                <div class="panel-close" onclick="togglePanel(null)">Ã—</div>
            </div>
            <div class="history-list" id="history-list">
                <div style="padding:10px; opacity:0.6;">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <div class="main-chat">
            <div class="chat-header" id="chat-header" style="display:none;">
                <div class="header-controls">
                    <select id="chat-model-sel" class="header-sel" onchange="updateChatSettings('model')"></select>
                    <select id="chat-role-sel" class="header-sel" onchange="updateChatSettings('role')"></select>
                </div>
            </div>

            <div class="chat-container" id="chat-box">
                <div style="text-align:center; color:var(--text-secondary); margin-top:10vh;">
                    <h2>My AI Assistant</h2><p>ç‚¹å‡»å·¦ä¸Šè§’â€œ+â€å¼€å¯æ–°å¯¹è¯</p>
                </div>
            </div>
            
            <div class="input-area">
                <div class="input-box">
                    <textarea id="inp" placeholder="å‘é€æ¶ˆæ¯... (Enterå‘é€)" rows="1"></textarea>
                    <button class="btn-send" onclick="sendMsg()"><svg class="icon" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
                </div>
            </div>
        </div>
    </div>

    <div id="create-prompt-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>âœ¨ åˆ›å»ºæ–°åŠ©æ‰‹</h3>
            <div class="form-group"><label>åŠ©æ‰‹åç§°</label><input type="text" id="new-prompt-name" class="styled-input" placeholder="ä¾‹å¦‚ï¼šç¿»è¯‘å®˜"></div>
            <div class="form-group"><label>å¼€åœºç™½</label><input type="text" id="new-prompt-greeting" class="styled-input" placeholder="ä½ å¥½ï¼Œæˆ‘æ˜¯..."></div>
            <div class="form-group"><label>è§’è‰²è®¾å®š</label><textarea id="new-prompt-content" class="styled-input" rows="10" placeholder="ä½ æ˜¯ä¸€ä¸ª..."></textarea></div>
            <button class="btn-primary" onclick="createPrompt()">åˆ›å»ºå¹¶ä¿å­˜</button>
            <button class="btn-close" onclick="closeModal('create-prompt-modal')">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="role-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>ğŸ¤– é€‰æ‹©åŠ©æ‰‹</h3>
            <select id="role-sel" class="styled-input"></select>
            <button class="btn-primary" onclick="startChat()">å¼€å§‹èŠå¤©</button>
            <button class="btn-close" onclick="closeModal('role-modal')">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-box settings-box">
            <div class="modal-header"><h3>âš™ï¸ å…¨å±€è®¾ç½®</h3><button class="btn-close" id="btn-close-settings" onclick="closeModal('settings-modal')">&times;</button></div>
            <div class="modal-content-scroll">
                <div style="background:rgba(0,0,0,0.2); padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid var(--border-color);">
                    <h4 style="margin:0 0 15px 0; color:#19c37d;">ğŸ”Œ API è¿æ¥é…ç½®</h4>
                    <div class="form-group"><label>APIåœ°å€</label><input type="text" id="cfg-url" class="styled-input"></div>
                    <div class="form-group"><label>APIå¯†é’¥</label><input type="password" id="cfg-key" class="styled-input"></div>
                    <div class="form-group">
                        <label>æ¨¡å‹åç§°</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="cfg-model" class="styled-input" style="flex:1;" list="model-list">
                            <datalist id="model-list"></datalist>
                            <button class="btn-secondary" onclick="fetchModels()" id="btn-fetch" style="white-space:nowrap;">ğŸ”„ è·å–</button>
                        </div>
                    </div>
                    <div class="form-group"><div style="display:flex; justify-content:space-between;"><label>æ¸©åº¦</label><span id="temp-val">0.7</span></div><input type="range" id="cfg-temp" min="0" max="2" step="0.1" oninput="document.getElementById('temp-val').innerText=this.value"></div>
                    <div style="display: flex; gap: 20px;">
                        <div class="form-group" style="flex: 1;"><label>æœ€å¤§Token</label><input type="number" id="cfg-tokens" class="styled-input"></div>
                        <div class="form-group"><label>æµå¼</label><label class="switch"><input type="checkbox" id="cfg-stream"><span class="slider round"></span></label></div>
                    </div>
                    <button class="btn-primary" onclick="saveApiConfig()" id="btn-save-api">ğŸ’¾ ä¿å­˜å¹¶è¿æ¥</button>
                </div>
                <div style="background:rgba(0,0,0,0.2); padding:15px; border-radius:8px; border:1px solid var(--border-color);">
                    <h4 style="margin:0 0 15px 0; color:#5865f2;">ğŸ¨ å¤–è§‚ä¸ä¸ªæ€§åŒ–</h4>
                    <div class="form-group"><label>ç”¨æˆ·æ˜µç§°</label><input type="text" class="styled-input" id="input-username"></div>
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <div style="flex: 1;"><label>ç”¨æˆ·å¤´åƒ</label><input type="text" class="styled-input" id="input-user-avatar"></div>
                        <div style="flex: 1;"><label>åŠ©æ‰‹å¤´åƒ</label><input type="text" class="styled-input" id="input-ai-avatar"></div>
                    </div>
                    <div class="form-group"><label>å­—ä½“å¤§å°</label><input type="range" min="12" max="24" id="font-range" oninput="updateFont(this.value)"></div>
                    <div class="form-group"><label>ä¸»é¢˜é€‰æ‹©</label><div class="theme-scroll-container" id="theme-list"></div></div>
                    <button class="btn-secondary" onclick="saveCustomization()" style="width:100%;">âœ… åº”ç”¨å¤–è§‚</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/static/js/main.js"></script>
    <script>
        // æ–°å¢çš„é¢æ¿åˆ‡æ¢é€»è¾‘
        function togglePanel(panelName) {
            const panel = document.getElementById('side-panel');
            if (!panelName) {
                panel.classList.remove('open');
            } else {
                if (panel.classList.contains('open')) {
                    panel.classList.remove('open');
                } else {
                    panel.classList.add('open');
                }
            }
        }
    </script>
</body>
</html>